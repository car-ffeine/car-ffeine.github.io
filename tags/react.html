<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">&quot;react&quot; 태그로 연결된 2개 게시물개의 게시물이 있습니다. | CAR-FFEINE</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://car-ffeine.github.io/tags/react"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" property="og:title" content="&quot;react&quot; 태그로 연결된 2개 게시물개의 게시물이 있습니다. | CAR-FFEINE"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="canonical" href="https://car-ffeine.github.io/tags/react"><link data-rh="true" rel="alternate" href="https://car-ffeine.github.io/tags/react" hreflang="ko"><link data-rh="true" rel="alternate" href="https://car-ffeine.github.io/tags/react" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="CAR-FFEINE RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="CAR-FFEINE Atom Feed"><link rel="stylesheet" href="/assets/css/styles.3f0749fa.css">
<link rel="preload" href="/assets/js/runtime~main.0bc4eaf8.js" as="script">
<link rel="preload" href="/assets/js/main.d39512cd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">CAR-FFEINE</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/woowacourse-teams/2023-car-ffeine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/26">카페인 팀 클라이언트의 테스트 자동화</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/25">flyway를 이제서야 적용하는 이유</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/24">Out of memory trouble shooting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/23">Deadlock trouble shooting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/22">필터링 기능 구현과 인덱스 이용한 조회 속도 개선하기</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>&quot;react&quot; 태그로 연결된 2개 게시물개의 게시물이 있습니다.</h1><a href="/tags">모든 태그 보기</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/13">충전소 리스트 클릭시 마커에 간단정보 모달을 띄우는 기능 추가에서 겪었던 트러블 슈팅</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-14T00:00:00.000Z" itemprop="datePublished">2023년 7월 14일</time> · <!-- -->약 18분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kyw0716" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/kyw0716.png" alt="센트"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/kyw0716" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">센트</span></a></div><small class="avatar__subtitle" itemprop="description">Frontend</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://file.notion.so/f/s/16a32751-2088-4261-8bf6-3d556c0bf2e8/Untitled.png?id=020fb0e2-81d8-4dca-bb76-cf4536ca7b29&amp;table=block&amp;spaceId=e725e94b-8029-47f5-aecb-8eb1ef7c939f&amp;expirationTimestamp=1689364800000&amp;signature=3KH3gvfzTgKmmFsrNBluQ3evQ6jwe2C-tj8LqB6gQyw&amp;downloadName=Untitled.png" alt="Untitled" class="img_ev3q"></p><p>위 이미지는 현재까지 구현한 지도의 모습이다. 구현된 기능은 다음과 같다.</p><ul><li>충전소 정보를 서버에 요청해 받아온 충전소 정보를 바탕으로 화면에 마커를 표시하는 기능</li><li>화면이 이동하거나 줌인, 줌 아웃을 할 시 화면의 마커 정보가 최신화 되는 기능</li><li>마커 정보를 최신화 할 때 화면에서 사라진 마커를 dom에서 제거하는 기능</li><li>마커 정보를 최신화 할 때 이전 화면에서도 있었던 마커를 재생성 하지 않는 기능</li><li>마커를 클릭했을 시 해당 마커에 대한 간단 정보를 모달로 띄워주는 기능</li><li>화면에 표시된 마커들에 대한 충전소 정보를 리스트로 보여주는 기능</li></ul><p>이번에 새로 추가하고자 한 기능은 다음과 같다.</p><ul><li>충전소 리스트에서 충전소를 선택하면 화면의 중심이 선택한 충전소 마커로 이동하고, 충전소의 간단 정보를 모달로 띄워주는 기능</li></ul><p>위 기능을 구현하기 위해선 google maps api의 InfoWindow객체를 이용해야 한다. 사용 방식은 다음과 같다.</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> infowindow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">google</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">maps</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">InfoWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contentString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">ariaLabel</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Uluru&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> marker </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">google</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">maps</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Marker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">position</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> uluru</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Uluru (Ayers Rock)&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">infowindow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">anchor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> marker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>간단하게 요약하자면 다음과 같다.</p><ul><li><code>InfoWindow</code> 생성자 함수를 통해 <code>infoWindow</code> 인스턴스를 생성한다.<ul><li>생성시 dom 요소 혹은 string을 전달해 <code>infoWindow</code>가 생성될 dom위치를 지정해준다.</li></ul></li><li><code>marker</code> 인스턴스를 <code>infoWindow</code> 인스턴스의 <code>open</code> 메서드에 인자로 전달한다.</li><li><code>infoWindow</code> 생성 시 전달했던 dom요소의 위치가 <code>marker</code>의 위치로 고정되면서 화면에 그려진다.</li></ul><hr><p><img loading="lazy" src="https://file.notion.so/f/s/3079d7b9-8226-46b1-9482-054d1ea78016/Untitled.png?id=bce7685b-8a95-429c-bb75-98a4402cfc17&amp;table=block&amp;spaceId=e725e94b-8029-47f5-aecb-8eb1ef7c939f&amp;expirationTimestamp=1689364800000&amp;signature=jKnY-AhoxwqTiWrMi66uUtIamSOZDj8GGBTzgKeu_qY&amp;downloadName=Untitled.png" alt="Untitled" class="img_ev3q"></p><p>충전소 정보를 보여주는 위 <code>StationList</code> 컴포넌트는 충전소 정보에 접근할 때 react-query를 통해 서버 상태를 직접 내려 받아 컴포넌트 내부 리스트를 렌더링 한다.</p><p>또한, <code>StationMarkersContainer</code>에서도 충전소 정보를 react-query의 서버 상태에서 참조해 마커를 렌더링 하고 있다.</p><p>따라서 <code>StationList</code> 컴포넌트와 <code>StationMarkersContainer</code>는 각각 따로 서버 상태에 접근해 렌더링을 수행하고 있으므로 둘 사이에는 어떠한 연결 고리가 없다.</p><p>여기서 문제가 발생하게 되었다.</p><hr><p>현재까지의 코드에서는 <code>infoWindow</code>인스턴스를 <code>StationMarkersContainer</code>컴포넌트에서 생성한다. 이를 하위 컴포넌트인 <code>StationMarker</code>에 내려주고, 이 컴포넌트 내부에서 <code>marker</code>인스턴스를 생성한다.</p><p>이번에 구현하기로 한 기능은 <code>StationList</code>의 항목 중 하나를 선택했을 시 선택된 충전소에 해당하는 마커에 간단 정보 모달이 뜨며 화면을 해당 마커가 중심으로 오도록 이동 시키는 것이었다.</p><p>하지만 지금의 코드 구조상 <code>StationList</code>와 <code>StationMarkersContainer</code>사이에는 어떠한 연결 고리도 없으므로 <code>infoWindow</code>와 <code>marker</code>에 <code>StationList</code>는 접근할 수 없는 상태가 된다.</p><p>이를 해결하기 위해서 다음과 같은 방법을 사용하기로 했다.</p><ul><li><code>infoWindow</code>인스턴스를 root 단에서 생성해 전역적으로 관리한다.</li><li>생성될 <code>marker</code> 인스턴스들을 배열 형태의 전역 상태로 관리한다.</li></ul><p>위 내용을 말로만 본다면 별로 어려울 것 없어 보이지만 실제 구현을 진행해보니 내부적으로 큰 문제가 두 가지 존재했다.</p><ol><li>따로 모듈을 분리해 <code>infoWindow</code>를 생성할 수 없다.</li><li><code>marker</code>인스턴스를 생성하는 주체가 <code>StationMarkersContainer</code>가 되어서는 안된다.</li></ol><p>각각의 문제점을 살펴보자.</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-따로-모듈을-분리해-infowindow를-생성할-수-없다">1. 따로 모듈을 분리해 <code>infoWindow</code>를 생성할 수 없다.<a href="#1-따로-모듈을-분리해-infowindow를-생성할-수-없다" class="hash-link" aria-label="1-따로-모듈을-분리해-infowindow를-생성할-수-없다에 대한 직접 링크" title="1-따로-모듈을-분리해-infowindow를-생성할-수-없다에 대한 직접 링크">​</a></h3><p><code>infoWinodw</code>를 전역 상태로 만들어 사용하기 위해 처음으로 했던 생각은 <code>infoWindowStore.ts</code>로 모듈을 분리하여 <code>infoWindow</code>를 생성해 store의 초기값으로 지정하는 것이었다.</p><p>위 생각을 가지고 그대로 구현해보았더니 <code>google</code>을 참조할 수 없다는 에러가 발생했다. <code>InfoWindow</code>생성자 함수는 <code>google.maps.InfoWindow</code>를 통해 접근할 수 있기 때문에 해당 에러는 <code>infoWindow</code>인스턴스를 생성할 수 없다는 것을 의미했다.</p><p>왜 <code>google</code>을 참조할 수 없는지 이유를 분석해보니 이유는 다음과 같았다.</p><p>우리 팀이 구글 지도 로드를 위해 선택한 라이브러리는 <code>@googlemaps/react-wrapper</code>이다. 이 라이브러리의 동작을 살펴보면 다음과 같다.</p><ul><li><code>Wrapper</code>컴포넌트가 <code>@googlemaps/js-loader</code>라이브러리의 <code>Loader</code>생성자 함수를 호출한다.</li><li>생성된 <code>loader</code>인스턴스의 <code>load</code>메서드를 실행시켜 지도의 로딩 작업을 시작한다.<ul><li><code>load</code> 메서드는 최종적으로 <code>Promise&lt;typeof google&gt;</code>을 반환하는데, 지도 로드에 성공하면 <code>resolve(window.google)</code> 을 실행시켜 <code>google</code>을 전역적으로 사용 가능하도록 만들어준다.</li></ul></li><li>지도의 로딩이 완료되면 <code>Wrapper</code>의 <code>render</code> props를 통해 받은 콜백 함수를 실행시킨다.<ul><li><code>render</code>콜백 함수는 로딩 상태를 나타내는 Status를 파라미터로 넘겨 받아 호출된다.</li></ul></li></ul><p>최종적으로 <code>render</code>를 실행 시켰을 때 반환 되는 컴포넌트에서는 <code>google</code> 로딩 되어 전역적으로 접근이 가능함을 보장할 수 있으므로 이때부터 <code>google</code>에 접근이 가능해진다. → 따라서 <code>Wrapper</code>를 통해 반환되는 컴포넌트의 하위 컴포넌트에서 <code>google.maps.Map</code>생성자 함수를 사용해 지도를 생성할 수 있게 된다.</p><p><code>infoWindow</code>를 생성하기 위해 만든 새로운 모듈은 첫 <code>import</code>시기에 평가될 것이기 때문에 <code>Wrapper</code>의 하위 컴포넌트에서 <code>import</code>를 수행한다면 로드가 완료된 이후 시점일 것이므로 <code>window.google</code>이 등록되어 <code>google</code>에 접근이 가능할 것으로 예상했다.</p><p>하지만 웹팩을 통한 번들링 과정에서 모듈이 뒤섞여 파일의 평가 시기를 보장할 수 없어져 새로 만든 모듈에서는 <code>google</code>에 대한 접근이 불가능해지게 되었다. 웹팩을 좀 더 공부해본다면 이 문제를 해결할 수 있을 것 같았지만, 너무 지엽적인 부분에서 많은 시간을 들이기 보단 기존에 개발하던 방식을 통해 문제를 해결해보기로 결정했다.</p><p>최종적으로 문제를 해결한 방식은 다음과 같다.</p><ul><li><code>InfoWindow</code>생성자 함수를 호출할 <code>CarFfeineInfoWindowInitializer</code>컴포넌트를 만든다.</li><li><code>Wrapper</code>로 감싸진 컴포넌트 하위에 <code>CarFfeineInfoWindowInitializer</code> 컴포넌트를 추가한다.</li><li><code>google</code>에 접근이 가능한 상태를 보장받은 <code>CarFfeineInfoWindowInitializer</code>내부에서 <code>infoWindow</code>인스턴스를 생성한다.</li><li><code>store</code>에 <code>infoWindow</code>인스턴스를 <code>set</code>해주어 전역적으로 <code>infoWindow</code>를 사용 가능하도록 한다.</li></ul><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-marker인스턴스를-생성하는-주체가-stationmarkerscontainer가-되어서는-안된다">2. <code>marker</code>인스턴스를 생성하는 주체가 <code>StationMarkersContainer</code>가 되어서는 안된다.<a href="#2-marker인스턴스를-생성하는-주체가-stationmarkerscontainer가-되어서는-안된다" class="hash-link" aria-label="2-marker인스턴스를-생성하는-주체가-stationmarkerscontainer가-되어서는-안된다에 대한 직접 링크" title="2-marker인스턴스를-생성하는-주체가-stationmarkerscontainer가-되어서는-안된다에 대한 직접 링크">​</a></h3><p>이번 팀 프로젝트에서 지도를 구현하기 위해 google maps api를 사용하게 되었다. 뜬금없이 이 이야기를 한 이유는 다음과 같다.</p><ul><li>google maps api는 바닐라 자바스크립트를 기반으로 동작한다.</li><li>이번 팀 프로젝트는 리액트를 기반으로 개발을 진행할 것이다.</li><li>지도를 그리기 위해서 바닐라 자바스크립트와 리액트의 적절한 조화가 필요하다.</li><li>다소 혼란스러울 수 있는 지도의 조작 방식을 리액트와 조화롭게 사용하기 위해서 컴포넌트 설계시 컴포넌트의 책임을 확실하게 구분해야겠다는 생각을 하게 되었다.</li></ul><p>이 컴포넌트의 책임에 대한 문제로 인해 <code>marker</code> 인스턴스를 생성하는 주체에 대해 많은 고민을 하게 되었다.</p><p>일단 원래 코드 구조에서 마커를 그리기 위해 컴포넌트를 다음과 같이 추상화 했다.</p><ul><li><code>StationMarkersContainer</code> 컴포넌트<ul><li>리액트 쿼리를 통해 받아온 서버 상태(충전소 정보 배열)로 <code>StationMarker</code>를 호출한다.</li></ul></li><li><code>StationMarker</code> 컴포넌트<ul><li>상위에서 내려받은 충전소 정보 props를 통해 <code>marker</code> 인스턴스를 생성한다. (google maps api에서는 인스턴스 생성이 곧 렌더링을 의미한다)</li><li>생성한 <code>marker</code> 인스턴스에 <code>infoWindow</code> 인스턴스의 <code>open</code> 메서드를 트리거 하는 클릭 이벤트 리스너를 추가해준다.</li><li><code>useEffect</code>의 클린업 함수를 이용해 충전소 정보가 최신화 되었을 때 마커가 더이상 화면에 보이지 않는다면 <code>marker</code> 인스턴스의 <code>setMap(null)</code> 메서드를 호출해 google maps api에서 마커를 지우도록 한다. (마커 렌더링 최적화)</li></ul></li></ul><p>간략히 설명하자면 <code>StationMarkersContainer</code> 컴포넌트는 충전소 정보를 서버에서 받아 <code>StationMarker</code>를 호출하는 역할만을 수행하고, 마커에 대한 모든 세부 로직은 <code>StationMarker</code>가 수행하도록 컴포넌트를 추상화 해보았다.</p><p>이름에서도 드러나듯 <code>StationMarker</code> 컴포넌트가 <code>marker</code> 인스턴스를 생성하는 주체가 되어야 바닐라 자바스크립트와 리액트의 혼종인 이 프로젝트의 코드를 추후 유지보수 할 때 문제가 없으리라 판단했다.</p><p>하지만 이렇게 추상화 된 컴포넌트들은 <code>marker</code> 인스턴스를 배열 형식의 전역 상태에 담아 관리하고자 할 때 문제가 되었다.</p><hr><p>일단 먼저 서버에서 내려 받은 충전소 정보를 <code>station</code>이라고 하자, 우리는 이 <code>station</code>을 통해 <code>marker</code> 인스턴스를 생성하고자 한다.</p><p>이때 생각 할 수 있는 가장 간단한 방법은 <code>station</code>에서 <code>map</code> 메서드를 통해 <code>marker</code> 인스턴스를 생성하여 이 <code>marker</code> 인스턴스를 하위 컴포넌트인 <code>StationMarker</code>에 넘겨주는 방식일 것이다.</p><p>하지만 이 방식은 인스턴스를 생성하는 것이 곧 화면에 렌더링을 발생시키는 것을 의미하는 google maps api의 특성상 우리가 처음 설계한 컴포넌트의 책임을 반하는 구조를 만들어내게 된다.</p><p>자세히 설명해보자면 마커의 렌더링은 <code>StationMarkersContainer</code>가 수행하고 있는데 화면에 보이지 않는 마커를 지우는 역할은 <code>StationMarker</code>컴포넌트가 수행하고 있고, 이벤트 핸들러의 추가 역시 마커가 생성된 이후에 하위 컴포넌트에서 이를 수행하는 괴상한 코드가 만들어지게 된다.</p><p>추후 코드의 유지보수성을 위해선 피해야 할 방식임이 명확했다.</p><p>해결 방식을 고민해보다가 다음과 같은 해결 방안을 생각하게 되었다.</p><p><code>StationMarker</code> 컴포넌트의 역할</p><ul><li><code>marker</code> 인스턴스를 생성한다.</li><li><code>marker</code> 인스턴스의 이벤트 핸들러를 추가한다.</li><li>생성된 <code>marker</code> 인스턴스를 배열 형식의 전역 상태에 추가한다.</li><li>충전소 정보가 최신화 되었을 때 마커가 화면에 보이지 않는 상태가 되었다면 <code>marker</code> 인스턴스를 전역 상태에서 삭제한다.</li></ul><p>위와 같이 <code>StationMarker</code> 의 역할을 잡게 되면 기존의 컴포넌트 설계 구조를 해치지 않으면서 전역 상태에 <code>marker</code>인스턴스를 잘 추가할 수 있게 된다. 하지만 이렇게 되면 <code>StationMarker</code> 컴포넌트는 다음의 큰 문제들을 가지게 된다.</p><ol><li><code>marker</code>들을 가지는 전역 상태를 구독하고 있는 컴포넌트가 새로 생성되는 마커의 개수만큼 리렌더링 된다.</li><li>현재 사용하고 있는 전역 상태 관리 도구의 특성상 이전 상태를 참조해와야 <code>marker</code>를 추가할 수 있게 되는데, 이 때 이전 상태가 최신의 상태임을 보장하지 못할 수 있다.</li></ol><p>이 두 문제를 해결할 방식을 고민해보았을 때 다음과 같은 결론에 도달하게 되었다.</p><ul><li>현재 사용하고 있는 전역 상태 관리 도구는 React 18에 새로 추가된 <code>useSyncExternalState</code> 훅을 기반으로 <code>recoil</code>과 비슷하게 사용할 수 있도록 계층을 분리하여 만든 도구이다.</li><li>기존에 사용하던 전역 상태 관리 도구의 메서드 <code>useExternalState</code>, <code>useExternalValue</code>, <code>useSetExternalState</code> 이외에 <code>store</code> 인스턴스에 직접 접근하여 최신의 상태를 참조하는 <code>getStoreSnapShot</code> 메서드를 추가한다.</li><li><code>store</code>에 직접 접근해 받아온 최신의 상태는 바닐라 자바스크립트 객체 이므로 리액트의 리렌더링을 발생 시키지 않는다.</li><li>리렌더링으로 인한 문제점들을 <code>getStoreSnapShot</code> 메서드를 추가함으로써 해결할 수 있다.</li></ul><hr><p>새로운 기능 추가를 위해 마주했던 앞선 두 가지의 문제와 해결 방식을 살펴 보았다. 그래서 최종적으로 이전까지 계속해서 고민해왔던 문제를 해결한 과정을 간추려보자면 다음과 같다.</p><ul><li>충전소 정보를 서버에서 받아와 렌더링 하는 <code>StationList</code> 컴포넌트에서 <code>marker</code> 인스턴스 배열을 저장하고 있는 <code>store</code>인스턴스에 직접 접근해 최신의 <code>marker</code>인스턴스들을 가져온다.</li><li>충전소 목록에서 사용자가 충전소를 클릭했을 때 전역으로 관리되는 <code>infoWindow</code> 인스턴스의 <code>open</code>메서드에 <code>marker</code> 인스턴스들 중 선택된 <code>marker</code>를 전달해 간단 정보 모달을 띄워준다.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/react">react</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/google-maps-api">google maps api</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/use-sync-external-store">useSyncExternalStore</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="블로그 게시물 목록 탐색"><a class="pagination-nav__link pagination-nav__link--next" href="/tags/react/page/2"><div class="pagination-nav__label">다음 페이지</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 CAR-FFEINE, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0bc4eaf8.js"></script>
<script src="/assets/js/main.d39512cd.js"></script>
</body>
</html>