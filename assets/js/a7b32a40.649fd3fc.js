"use strict";(self.webpackChunkcar_ffeine=self.webpackChunkcar_ffeine||[]).push([[4573],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>g});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var u=a.createContext({}),c=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},s=function(e){var n=c(e.components);return a.createElement(u.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,u=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),p=c(t),h=l,g=p["".concat(u,".").concat(h)]||p[h]||d[h]||r;return t?a.createElement(g,o(o({ref:n},s),{},{components:t})):a.createElement(g,o({ref:n},s))}));function g(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,o=new Array(r);o[0]=h;var i={};for(var u in n)hasOwnProperty.call(n,u)&&(i[u]=n[u]);i.originalType=e,i[p]="string"==typeof e?e:l,o[1]=i;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},98805:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var a=t(87462),l=(t(67294),t(3905));const r={slug:35,title:"Scale-out \uc2dc Scheduling \uc911\ubcf5 \uc2e4\ud589 \ub9c9\uae30",authors:["boxster"],tags:["java"]},o=void 0,i={permalink:"/35",source:"@site/blog/2023-09-18-scheduling.mdx",title:"Scale-out \uc2dc Scheduling \uc911\ubcf5 \uc2e4\ud589 \ub9c9\uae30",description:"\uc548\ub155\ud558\uc138\uc694 \ubc15\uc2a4\ud130\uc785\ub2c8\ub2e4",date:"2023-09-18T00:00:00.000Z",formattedDate:"2023\ub144 9\uc6d4 18\uc77c",tags:[{label:"java",permalink:"/tags/java"}],readingTime:8.89,hasTruncateMarker:!1,authors:[{name:"\ubc15\uc2a4\ud130",title:"Backend",url:"https://github.com/drunkenhw",imageURL:"https://github.com/drunkenhw.png",key:"boxster"}],frontMatter:{slug:"35",title:"Scale-out \uc2dc Scheduling \uc911\ubcf5 \uc2e4\ud589 \ub9c9\uae30",authors:["boxster"],tags:["java"]},prevItem:{title:"\ub9c8\ucee4 \ub80c\ub354\ub9c1 \ucd5c\uc801\ud654",permalink:"/36"},nextItem:{title:"\uce90\uc2dc\uc640 \uc774\ubd84 \ud0d0\uc0c9\uc73c\ub85c \uc870\ud68c \uc131\ub2a5 \uac1c\uc120\ud558\uae30",permalink:"/34"}},u={authorsImageUrls:[void 0]},c=[{value:"\uc774 \uae00\uc744 \uc4f0\ub294 \uc774\uc720",id:"\uc774-\uae00\uc744-\uc4f0\ub294-\uc774\uc720",level:2},{value:"\uad6c\ud604\ud574\ubcf4\uae30",id:"\uad6c\ud604\ud574\ubcf4\uae30",level:2},{value:"\uacb0\ub860",id:"\uacb0\ub860",level:2}],s={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,l.kt)(p,(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\uc548\ub155\ud558\uc138\uc694 \ubc15\uc2a4\ud130\uc785\ub2c8\ub2e4"),(0,l.kt)("h2",{id:"\uc774-\uae00\uc744-\uc4f0\ub294-\uc774\uc720"},"\uc774 \uae00\uc744 \uc4f0\ub294 \uc774\uc720"),(0,l.kt)("p",null,"\uc800\ud76c \uc11c\ube44\uc2a4\uc5d0\uc11c\ub294 \uc8fc\uae30\uc801\uc73c\ub85c \ucda9\uc804\uae30\uc758 \uc0c1\ud0dc\uc640 \uc815\ubcf4\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uac70\ub098, \ud1b5\uacc4\ub97c \uc800\uc7a5\ud558\ub294 \uc2a4\ucf00\uc904\ub9c1 \uc791\uc5c5\uc774 \uc788\uc2b5\ub2c8\ub2e4.\n\uc9c0\uae08\uc758 \uc800\ud76c \uc11c\ubc84\ub294 \ub2e8\uc77c \uc11c\ubc84\ub85c \uad6c\uc131\ub418\uc5b4\uc788\uc5b4 \ubb38\uc81c\uac00 \uc5c6\uc9c0\ub9cc, \ub9cc\uc57d ",(0,l.kt)("strong",{parentName:"p"},"\uc11c\ubc84\ub97c scale-out")," \ud558\uac8c \ub41c\ub2e4\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c\uc694?"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\ub611\uac19\uc740 schedule\uc774 \uc911\ubcf5"),"\ub418\uc5b4 \uc2e4\ud589\ub420 \uac83\uc785\ub2c8\ub2e4. \uadf8\ub807\ub2e4\uace0 \uc5b4\ub5a4 \uc11c\ubc84\ub294 schedule\uc744 \ub3d9\uc791\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud558\uace0, \uc5b4\ub5a4 \uc11c\ubc84\ub294 schedule\uc744 \ub3d9\uc791\ud558\ub3c4\ub85d \ud55c\ub2e4\uba74 \uc2a4\ucf00\uc904\uc774 \ub3d9\uc791\ud558\ub294 \uc11c\ubc84\uac00 \ub2e4\uc6b4\ub41c\ub2e4\uba74 \ub3d9\uc791\ud558\ub294\n\uc11c\ubc84\uc758 \ub2e4\uc6b4\ud0c0\uc784\ub9cc\ud07c \uc800\ud76c \uc11c\ubc84\uc758 \ub370\uc774\ud130\ub97c \ucd5c\uc2e0\ud654\ud560 \uc218 \uc5c6\uace0, \ucd5c\uc2e0\ud654\uac00 \uc911\uc694\ud55c \uc800\ud76c \uc11c\ube44\uc2a4\uc5d0\uc11c\ub294 \uc0ac\uc6a9\uc790\uc758 \ubd88\ub9cc\uc744 \ucd08\ub798\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h2",{id:"\uad6c\ud604\ud574\ubcf4\uae30"},"\uad6c\ud604\ud574\ubcf4\uae30"),(0,l.kt)("p",null,"Schedule \uc815\ubcf4\ub97c \uc5b4\ub5bb\uac8c \ub2e4\ub978 \ud658\uacbd\uc5d0\uc11c \uac19\uc774 \uacf5\uc720\ud558\uc5ec \uad00\ub9ac\ud560 \uc218 \uc788\uc744\uae4c\uc694?\n\uac04\ub2e8\ud788 \uc0dd\uac01\ud558\uba74 Local \ud658\uacbd\uc774 \uc544\ub2cc, Global \ud658\uacbd\uc5d0\uc11c \uc815\ubcf4\ub97c \uad00\ub9ac\ud558\uba74 \ub420 \uac83 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub530\ub77c\uc11c Schedule\uc758 \uc815\ubcf4\ub97c \uc800\uc7a5\ud560 \uc218 \uc788\ub294 \ud14c\uc774\ube14\uc744 \uc544\ub798\uc758 Entity \uc758 \ud544\ub4dc\uc640 \uac19\uc774 \uc0dd\uc131\ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Entity\npublic class ScheduleTask extends BaseEntity {\n\n  @Id\n  private String id;\n\n  private String jobName;\n\n  @Enumerated(EnumType.STRING)\n  private JobStatus status;\n}\n")),(0,l.kt)("p",null,"\uba3c\uc800 id\ub294 \ud574\ub2f9 \uc2a4\ucf00\uc904\uc744 \uad6c\ubd84\ud560 \uc218 \uc788\ub294 id\uc5ec\uc57c \ud560 \uac83\uc785\ub2c8\ub2e4. \uac00\uc7a5 \uc27d\uac8c \uc815\ud560 \uc218 \uc788\ub294 id\ub294 \uc2a4\ucf00\uc904\uc758 ",(0,l.kt)("strong",{parentName:"p"},"job \uc774\ub984"),"\uacfc,\nSchedule\uc73c\ub85c \ub4f1\ub85d\ud55c ",(0,l.kt)("strong",{parentName:"p"},"\uc2dc\uac04"),"\uc744 \uc870\ud569\ud558\uc5ec \uc0dd\uc131\ud55c\ub2e4\uba74 unique\ud558\uace0 \ubd84\uc0b0 \ud658\uacbd\uc5d0\uc11c\ub3c4 \uc27d\uac8c \uad6c\ubd84\ud560 \uc218 \uc788\ub294 id\uac00 \ub420 \uac83 \uc785\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uadf8\ub9ac\uace0 \uc544\ub798\uc640 \uac19\uc740 Business Logic \uc788\ub2e4\uace0 \uac00\uc815\ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Service\npublic class BusinessLogic {\n\n  private final ApplicationEventPublisher applicationEventPublisher;\n\n  @Scheduled(cron = "0/2 * * * * *")\n  public void complexJob() {\n    log.info("\ubcf5\uc7a1\ud55c Job \uc2dc\uc791");\n  }\n\n  @Scheduled(cron = "0/4 * * * * *")\n  public void moreComplexJob() {\n    log.info("\uc880 \ub354 \ubcf5\uc7a1\ud55c Job \uc2dc\uc791");\n    try {\n      Thread.sleep(3000);\n    } catch (InterruptedException e) {\n      throw new RuntimeException(e);\n    }\n  }\n}\n')),(0,l.kt)("p",null,"\ud558\ub098\ub294 \ub9e4 2\ucd08\ub9c8\ub2e4 \uc2e4\ud589 \ud6c4 \ubc14\ub85c \uc885\ub8cc\ub418\uace0, \ud558\ub098\ub294 \ub9e4 4\ucd08\ub9c8\ub2e4 \uc2e4\ud589 \ud6c4 3\ucd08\uc758 \ub300\uae30\uc640 \uc885\ub8cc\ub418\ub294 \uba54\uc11c\ub4dc\uc785\ub2c8\ub2e4.\n\uc774\ub7f0 \uc2a4\ucf00\uc904\uc740 \uc5b4\ub5bb\uac8c \ub3d9\uc791\ud560\uae4c\uc694? \uc800\ub294 \ub2f9\uc5f0\ud788 2\ucd08\uc640 4\ucd08\ub9c8\ub2e4 \ud574\ub2f9 \uba54\uc11c\ub4dc\uac00 \uc2e4\ud589\ub420 \uc904 \uc54c\uc558\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub85c\uadf8\ub97c \uc0b4\ud3b4\ubcf4\uba74 \uc544\ub798\uc640 \uac19\uc740 \uacb0\uacfc\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.\n",(0,l.kt)("img",{parentName:"p",src:"https://github.com/drunkenhw/comments/assets/106640954/5e275085-fce6-43ae-88ca-d3f9c484b6f3",alt:"log"}),"\n\ubcf5\uc7a1\ud55c job\uc774 2\ubc88 \uc2e4\ud589\ub420 \ub54c, \uc880 \ub354 \ubcf5\uc7a1\ud55c job\uc774 1\ubc88 \uc2e4\ud589\ub418\ub294 \uac78 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\uc0c1\ud588\ub358 \uacb0\uacfc\uc785\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ud558\uc9c0\ub9cc \uc2e4\ud589\ub41c \uc2dc\uac04\uc744 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.\n",(0,l.kt)("img",{parentName:"p",src:"https://github.com/drunkenhw/comments/assets/106640954/abbe2c65-c26b-46ba-a4e3-fc0f4e5a6612",alt:"log-with-time"})),(0,l.kt)("p",null,"\ubd84\uba85 \ub9e4 2\ucd08\uc640 4\ucd08\ub9c8\ub2e4 \uc2e4\ud589\ud558\uae30 \ub54c\ubb38\uc5d0 \uc791\uc5c5 \uc2dc\uac04\uc774 2\uc758 \ubc30\uc218\uac00 \ub418\uc5b4\uc57c\ud560\ud150\ub370"),(0,l.kt)("p",null,"34, 36, 36, ",(0,l.kt)("strong",{parentName:"p"},"39"),", 40, 40, ",(0,l.kt)("strong",{parentName:"p"},"43"),", 44, 44, ",(0,l.kt)("strong",{parentName:"p"},"47"),"\ucd08 \ub85c \uc810\uc810 \uc791\uc5c5\uc774 \ubc00\ub9ac\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uc65c \uadf8\ub7f4\uae4c\uc694? \uc2a4\ud504\ub9c1 \uacf5\uc2dd \ubb38\uc11c\uc5d0\uc11c\ub294 \uc544\ub798\uc640 \uac19\uc774 \uc124\uba85\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"A ThreadPoolTaskScheduler can also be auto-configured if need to be associated to scheduled task execution (using @EnableScheduling for instance). The thread pool uses one thread by default and its settings can be fine-tuned using the spring.task.scheduling namespace, as shown in the following example:")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.task-execution-and-scheduling"},"\ucc38\uace0 - \uc2a4\ud504\ub9c1 \uacf5\uc2dd \ubb38\uc11c")),(0,l.kt)("p",null,"\uc2a4\ud504\ub9c1\uc758 Schedule\uc740 Default\ub85c \ud558\ub098\uc758 \uc2f1\uae00 \uc2a4\ub808\ub4dc\uc5d0\uc11c \ub3d9\uc791\ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.\n\uadf8\ub807\uae30 \ub54c\ubb38\uc5d0 \ub9e4\ubc88 \uc791\uc5c5\uc774 \ubc00\ub824 \uc6d0\ud558\ub294 \uc2dc\uac04\uc5d0 \ub3d9\uc791\ud558\uc9c0 \uc54a\ub294 \ud604\uc0c1\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ud558\uc9c0\ub9cc Schedule\uc744 \ubd84\uc0b0 \ud658\uacbd\uc5d0\uc11c \uad6c\ubd84\ud558\uae30 \uc704\ud574\uc11c\ub294 job\uc774 \uc2e4\ud589\ub41c \uc2dc\uac04\uc774 \uc911\uc694\ud558\uae30 \ub54c\ubb38\uc5d0 \uc774\ub807\uac8c \uc791\uc5c5\uc774 \ubc00\ub824\ubc84\ub9b0\ub2e4\uba74 \uad6c\ubd84\uc744 \ud560 \uc218 \uc5c6\uac8c \ub429\ub2c8\ub2e4.\n\ub530\ub77c\uc11c Schedule Thread Pool Size\ub97c \ub298\ub9ac\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\npublic class ScheduleConfig implements SchedulingConfigurer {\n    @Override\n    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {\n        ThreadPoolTaskScheduler taskScheduler = new ThreadPoolTaskScheduler();\n        taskScheduler.setPoolSize(10);\n        taskScheduler.setThreadNamePrefix("schedule-task-");\n        taskScheduler.initialize();\n        taskRegistrar.setTaskScheduler(taskScheduler);\n    }\n}\n')),(0,l.kt)("p",null,"SchedulingConfigurer \ub97c \uad6c\ud604\ud558\uc5ec Thread Pool size\ub97c \uc77c\ub2e8 10\uac1c\ub85c \uc815\uc758\ud588\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/drunkenhw/comments/assets/106640954/14b225bc-297e-4e7d-b196-23d779f635c0",alt:"success"}),"\n\uc2a4\ub808\ub4dc \ud480\uc744 \ub298\ub838\ub354\ub2c8 \uc704\uc640 \uac19\uc774 2\uc758 \ubc30\uc218\uc758 \uc2dc\uac04\uc5d0 \uc815\ud655\ud788 \uc791\ub3d9\uc774 \ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ud558\uc9c0\ub9cc \uc774\ub807\uac8c \uc5ec\ub7ec \uc791\uc5c5\uc744 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\ub41c\ub2e4\uba74 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \ubcd1\ubaa9\ud604\uc0c1\uc774 \ubc1c\uc0dd\ub418\uc5b4 \uc624\ud788\ub824 \uc791\uc5c5\uc774 \ub354 \ub290\ub9ac\uac8c \ub05d\ub0a0 \uc218\ub3c4 \uc788\ub2e4\uace0 \uc0dd\uac01\ud588\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uadf8\ub798\uc11c \ud574\ub2f9 \ubd80\ubd84\uc758 \uc2e4\ud589\uc744 \uad00\ub9ac\ud558\ub294 \ud074\ub798\uc2a4\ub97c \uc0dd\uc131\ud558\uc5ec \ud574\ub2f9 \ud074\ub798\uc2a4\uc5d0\uc11c Schedule\uc758 \uc791\uc5c5\uc744 \uad00\ub9ac\ud558\ub3c4\ub85d \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Service\npublic class BusinessLogic {\n\n    private final ApplicationEventPublisher applicationEventPublisher;\n\n    @Scheduled(cron = "0/2 * * * * *")\n    public void complexJobSchedule() {\n        applicationEventPublisher.publishEvent(new SchedulingEvent(this::complexJob, "complexJob", LocalDateTime.now()));\n    }\n\n    @Scheduled(cron = "0/4 * * * * *")\n    public void moreComplexJobSchedule() {\n        applicationEventPublisher.publishEvent(new SchedulingEvent(this::moreComplexJob, "moreComplexJob", LocalDateTime.now()));\n    }\n}\n')),(0,l.kt)("p",null,"\ub85c\uc9c1\uc774 \uc788\ub294 BusinessLogic \uc11c\ube44\uc2a4\uc5d0\uc11c \uc2a4\ucf00\uc904\uc758 \uc2dc\uac04\ub9c8\ub2e4 \uc2e4\ud589\ud574\uc57c\ud560 \uba54\uc11c\ub4dc\ub97c Event\ub85c \ubc1c\ud589\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class ScheduleService {\n\n  private final ExecutorService executorService = Executors.newFixedThreadPool(1);\n  private final Queue<SchedulingEvent> scheduleTasks = new ConcurrentLinkedQueue<>();\n  private final AtomicBoolean isRunning = new AtomicBoolean(false);\n\n  @EventListener\n  public void addTask(SchedulingEvent schedulingEvent) {\n    scheduleTasks.add(schedulingEvent);\n  }\n\n  @Scheduled(cron = "0/1 * * * * *")\n  public void polling() {\n    if (!scheduleTasks.isEmpty() || isRunning.compareAndSet(false, true)) {\n      SchedulingEvent schedulingEvent = scheduleTasks.poll();\n      executorService.execute(() -> execute(schedulingEvent));\n    }\n  }\n}\n')),(0,l.kt)("p",null,"\uadf8\ub9ac\uace0 \uc704\uc640 \uac19\uc740 \uc2a4\ucf00\uc904\uc744 \uad00\ub9ac\ud558\ub294 \uc11c\ube44\uc2a4\uc5d0\uc11c\ub294 Schedule Event\ub97c \ubc1b\uc544 \uc2e4\ud589\ud558\ub3c4\ub85d \ub9cc\ub4e4\uc5c8\uc2b5\ub2c8\ub2e4. \ud574\ub2f9 \ud074\ub798\uc2a4\uc5d0\uc11c\ub294 ThreadPool\uc744 \uc0c8\ub85c \uc0dd\uc131\ud558\uc5ec, schedule\uc758 \uc2a4\ub808\ub4dc\uc5d0 \uc601\ud5a5\uc744 \ubc1b\uc9c0 \uc54a\ub3c4\ub85d \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uadf8\ub9ac\uace0 1\ucd08\ub9c8\ub2e4 \uc2e4\ud589\ub418\ub294 \uc2a4\ucf00\uc904\uc744 \ub9cc\ub4e4\uc5b4 queue\uc5d0 \uc791\uc5c5\uc774 \uc788\ub294\uc9c0, \ud604\uc7ac \uc791\uc5c5 \uc911\uc778\uc9c0 \ud655\uc778\ud558\uc5ec \uadf8\ub807\uc9c0 \uc54a\ub2e4\uba74 queue\uc5d0\uc11c \uc791\uc5c5\uc744 \uaebc\ub0b4 \uc2e4\ud589\ud558\ub3c4\ub85d \ub9cc\ub4e4\uc5c8\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uac70\uc758 \uad6c\ud604\uc774 \ub05d\ub098\uac11\ub2c8\ub2e4. \uc774\uc81c\ub294 \ud574\ub2f9 Schedule\uc758 \ub370\uc774\ud130\ub97c \uc800\uc7a5\ud558\uace0, \uc791\uc5c5\uc774 \uc2e4\ud328\ud588\uc744 \uc2dc\uc5d0 \ub2e4\uc2dc \uc791\uc5c5\uc744 \ud558\uae30 \uc704\ud55c \uae30\ub2a5\ub9cc \uad6c\ud604\ud558\uba74 \ub420 \uac83 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class ScheduleService {\n\n    ...\n\n    private void execute(SchedulingEvent schedulingEvent) {\n        String jobId = schedulingEvent.jobId();\n        LocalDateTime executionTime = schedulingEvent.executionTime();\n\n        if (isJobInProgressOrDone(jobId)) {\n            log.info("\uc791\uc5c5\uc774 \uc2e4\ud589\uc911\uc785\ub2c8\ub2e4. {} {}", executionTime, jobId);\n            return;\n        }\n        ScheduleTask entity = new ScheduleTask(jobId, executionTime, JobStatus.RUNNING);\n        scheduleTaskJdbcRepository.save(entity);\n\n        try {\n            schedulingEvent.runnable().run();\n            scheduleTaskJdbcRepository.updateById(entity.getId(), JobStatus.DONE);\n        } catch (Exception e) {\n            log.error("{} \uc791\uc5c5 \uc2e4\ud589 \uc911 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.", jobId);\n            scheduleTaskJdbcRepository.updateById(entity.getId(), JobStatus.ERROR);\n            tasks.add(schedulingEvent);\n        }\n    }\n\n    private boolean isJobInProgressOrDone(String jobId) {\n        Optional<ScheduleTask> taskOptional = scheduleTaskRepository.findById(jobId);\n        if (taskOptional.isPresent()) {\n            ScheduleTask scheduleTask = taskOptional.get();\n            return scheduleTask.getStatus() == JobStatus.RUNNING || scheduleTask.getStatus() == JobStatus.DONE;\n        }\n        return false;\n    }\n}\n')),(0,l.kt)("p",null,"\uc774 \ubd80\ubd84\uc740 \uac04\ub2e8\ud558\uac8c \uad6c\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc704\uc640 \uac19\uc774 \uc791\uc5c5\uc758 \uc2e4\ud589 \uc2dc\uac04\uacfc, job\uc758 \uc774\ub984\uc73c\ub85c \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0\uc11c \uc870\ud68c\ud558\uace0, \uc5c6\ub2e4\uba74 \uc791\uc5c5\uc744 \uc2e4\ud589\ud558\uace0\n\uc788\ub2e4\uba74 \uc791\uc5c5\uc774 ERROR \uc778\uc9c0 \ud655\uc778\ud558\uc5ec \uc791\uc5c5\uc744 \uc2e4\ud589\ud574\uc8fc\uba74 \ub420 \uac83 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/drunkenhw/comments/assets/106640954/3ff855db-ff8e-4aa4-8b47-ed5b2ff6dd64",alt:"complete"})),(0,l.kt)("p",null,"\uc704\uc640 \uac19\uc774 \ub450 \uac1c\uc758 \uc11c\ubc84\ub97c \ub3d9\uc2dc\uc5d0 \ub744\uc6e0\uc744 \ub54c\uc5d0\ub3c4 \uc2a4\ucf00\uc904\uc774 \uc798 \uc791\ub3d9\ud558\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h2",{id:"\uacb0\ub860"},"\uacb0\ub860"),(0,l.kt)("p",null,"\uc2a4\ucf00\uc904\uc744 \uc774\ub807\uac8c \uad6c\ud604\ud560 \uc218\ub3c4 \uc788\uc9c0\ub9cc \ud658\uacbd\uc774 \ub41c\ub2e4\uba74 Message Queue\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc5b4\ub5a8\uae4c\uc694?"),(0,l.kt)("p",null,"\ud639\uc2dc \ud2c0\ub9b0 \ubd80\ubd84\uc774 \uc788\ub2e4\uba74 \uc9c0\uc801 \ubd80\ud0c1\ub4dc\ub9bd\ub2c8\ub2e4."))}d.isMDXComponent=!0}}]);